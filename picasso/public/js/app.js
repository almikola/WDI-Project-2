"use strict";var App=App||{},google=google;App.mapSetup=function(){App.apiUrl="http://localhost:3000/api";var o=document.getElementById("map-canvas"),e={zoom:3,center:new google.maps.LatLng(51.506178,(-.088369)),mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(o,e),this.addArt()},App.addArt=function(){$.get({url:App.apiUrl+"/art",beforeSend:App.setRequestHeader.bind(App)}).done(function(o){var e=new google.maps.Geocoder;$.each(o.arts,function(o,n){console.log(n),setTimeout(function(){e.geocode({address:n.location},function(o,e){if(e===google.maps.GeocoderStatus.OK){var t=o[0].geometry.location.lat(),a=o[0].geometry.location.lng(),i=new google.maps.LatLng(t,a),s=new google.maps.Marker({position:i,map:App.map,animation:google.maps.Animation.DROP});App.addInfoWindow(n,s)}})},200*o)})})},App.addInfoWindow=function(o,e){var n=this;google.maps.event.addListener(e,"click",function(){"undefined"!=typeof n.infoWindow&&n.infoWindow.close(),n.infoWindow=new google.maps.InfoWindow({content:"<p>"+o.location+"</p>"}),n.infoWindow.open(n.map,e)})},App.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),this.$main.on("submit","form",this.handleForm),this.getToken()?this.loggedInState():this.loggedOutState()},App.loggedInState=function(){console.log("loggedin"),$(".loggedIn").show(),$(".loggedOut").hide(),this.$main.html('<div id="map-canvas"></div>'),App.mapSetup()},App.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show(),this.register()},App.register=function(o){o&&o.preventDefault(),$(".modal-content").html('\n    <div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <h2>Register</h2>\n    <form method="post" action="/register">\n    <div class="form-group">\n    <input class="form-control" type="text" name="user[username]" placeholder="Username">\n    </div>\n    <div class="form-group">\n    <input class="form-control" type="email" name="user[email]" placeholder="Email">\n    </div>\n    <div class="form-group">\n    <input class="form-control" type="password" name="user[password]" placeholder="Password">\n    </div>\n    <div class="form-group">\n    <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n    </div>\n    <input class="btn btn-primary" type="submit" value="Register">\n    </form>\n    '),$(".modal").modal("show")},App.login=function(o){o.preventDefault(),$(".modal-content").html('\n      <div class="modal-header">\n      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n      <h2>Login</h2>\n      <form method="post" action="/login">\n      <input class="form-control" type="email" name="email" placeholder="Email">\n      </div>\n      <div class="form-group">\n      <input class="form-control" type="password" name="password" placeholder="Password">\n      </div>\n      <input class="btn btn-primary" type="submit" value="Login">\n      </form>\n      '),$(".modal").modal("show")},App.logout=function(o){o.preventDefault(),this.removeToken(),this.loggedOutState()},App.artIndex=function(o){console.log("this is runningNow"),o&&o.preventDefautl();var e=this.apiUrl+"/art";return this.ajaxRequest(e,"get",null,function(o){console.log(o)})},App.handleForm=function(o){o.preventDefault();var e=""+App.apiUrl+$(this).attr("action"),n=$(this).attr("method"),t=$(this).serialize();return App.ajaxRequest(e,n,t,function(o){o.token&&App.setToken(o.token),App.loggedInState()})},App.ajaxRequest=function(o,e,n,t){return $.ajax({url:o,method:e,data:n,beforeSend:App.setRequestHeader.bind(this)}).done(t).fail(function(o){console.log(o)})},App.setRequestHeader=function(o){return console.log("setting header"),o.setRequestHeader("Authorization","Bearer "+this.getToken())},App.setToken=function(o){return console.log("token set"),window.localStorage.setItem("token",o)},App.getToken=function(){return console.log("token got"),window.localStorage.getItem("token")},App.removeToken=function(){return console.log("token removed"),window.localStorage.clear()},$(App.init.bind(App));